<!-- core/templates/swap_dashboard.html -->
{% extends "base.html" %}
{% block title %}My Swap Dashboard{% endblock %}

{% block content %}
<h2 class="mb-4">My Swap Dashboard</h2>

<!-- Display any messages -->
{% if messages %}
    {% for message in messages %}
    <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
        {{ message }}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
    {% endfor %}
{% endif %}

<!-- Incoming Requests -->
<div class="card mb-4">
    <div class="card-header">
        <h4><i class="bi bi-box-arrow-in-down"></i> Incoming Requests (Pending)</h4>
    </div>
    <ul class="list-group list-group-flush">
        {% for req in incoming_requests %}
        <li class="list-group-item d-flex justify-content-between align-items-center">
            <span>Swap request from <strong>{{ req.requester.username }}</strong></span>
            <div>
                <form method="post" action="{% url 'update_swap_status' req.id 'accepted' %}" class="d-inline">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-success btn-sm">Accept</button>
                </form>
                <form method="post" action="{% url 'update_swap_status' req.id 'rejected' %}" class="d-inline">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-danger btn-sm">Reject</button>
                </form>
            </div>
        </li>
        {% empty %}
        <li class="list-group-item text-muted">No new incoming requests.</li>
        {% endfor %}
    </ul>
</div>

<!-- Sent Requests -->
<div class="card mb-4">
    <div class="card-header">
        <h4><i class="bi bi-box-arrow-up"></i> My Sent Requests</h4>
    </div>
    <ul class="list-group list-group-flush">
        {% for req in sent_requests %}
        <li class="list-group-item d-flex justify-content-between align-items-center">
            <span>Request to <strong>{{ req.responder.username }}</strong></span>
            {% if req.status == 'pending' %}
                <span class="badge bg-warning text-dark">Pending</span>
                <form method="post" action="{% url 'update_swap_status' req.id 'cancelled' %}" class="d-inline">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-outline-secondary btn-sm">Cancel</button>
                </form>
            {% elif req.status == 'rejected' %}
                <span class="badge bg-danger">Rejected</span>
            {% elif req.status == 'cancelled' %}
                <span class="badge bg-secondary">Cancelled</span>
            {% endif %}
        </li>
        {% empty %}
        <li class="list-group-item text-muted">You haven't sent any requests.</li>
        {% endfor %}
    </ul>
</div>

<!-- Active Swaps -->
<div class="card">
    <div class="card-header">
        <h4><i class="bi bi-check-circle-fill text-success"></i> Active Swaps</h4>
    </div>
    <ul class="list-group list-group-flush">
        {% for swap in active_swaps %}
        <li class="list-group-item">
            Swap with <strong>{% if swap.requester == request.user %}{{ swap.responder.username }}{% else %}{{ swap.requester.username }}{% endif %}</strong> is active!
            <!-- In a later phase, we'd add contact details or a chat here -->
        </li>
        {% empty %}
        <li class="list-group-item text-muted">No active swaps yet.</li>
        {% endfor %}
    </ul>
</div>
{% endblock %}